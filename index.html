<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Cadastro de Clientes</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2, h3 {
            color: #333;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
            margin-bottom: 20px;
        }
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            color: black;
            margin-top: 0;
        }
        .tab button:hover {
            background-color: #ddd;
        }
        .tab button.active {
            background-color: #4CAF50;
            color: white;
        }
        .tabcontent {
            display: none;
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-top: none;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .search {
            margin: 20px 0;
        }
        .export-btn {
            background-color: #2196F3;
            margin-right: 10px;
        }
        .export-btn:hover {
            background-color: #0b7dda;
        }
        .delete-btn {
            background-color: #f44336;
            margin-left: 5px;
        }
        .delete-btn:hover {
            background-color: #d32f2f;
        }
        .whatsapp-btn {
            background-color: #25D366;
            margin-left: 5px;
        }
        .whatsapp-btn:hover {
            background-color: #128C7E;
        }
        .edit-btn {
            background-color: #FFC107;
            margin-left: 5px;
        }
        .edit-btn:hover {
            background-color: #FFA000;
        }
        #qrcodeContainer {
            text-align: center;
            margin: 20px 0;
        }
        .card {
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
            transition: 0.3s;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
        }
        .success-message {
            color: green;
            font-weight: bold;
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        #birthdayMessage {
            width: 100%;
            height: 200px;
            margin-top: 10px;
            padding: 10px;
            box-sizing: border-box;
        }
        .message-template {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            border-left: 4px solid #4CAF50;
        }
        .qr-code-view .tab {
            display: none;
        }
        .qr-code-view .tabcontent {
            display: none;
            border: none;
            padding: 0;
        }
        .qr-code-view #clienteTab {
            display: block;
        }
        .qr-code-view h1 {
            text-align: center;
        }
        .vendedor-area {
            margin-top: 30px;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }
        .filter-vendedor {
            margin-bottom: 15px;
        }
        .clientes-container {
            max-height: 500px;
            overflow-y: auto;
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .optional-field {
            color: #666;
            font-style: italic;
        }
        .instructions {
            background-color: #f8f9fa;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 20px 0;
            font-size: 14px;
        }
        .instructions ol {
            padding-left: 20px;
        }
        /* Estilos para o modal de edi√ß√£o */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 5px;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover {
            color: black;
        }
    </style>
</head>
<body>
    <h1>Sistema de Cadastro de Clientes</h1>
    
    <div class="tab">
        <button class="tablinks active" onclick="openTab(event, 'adminTab')">Administra√ß√£o</button>
        <button class="tablinks" onclick="openTab(event, 'qrcodeTab')">Gerar QR Code</button>
        <button class="tablinks" onclick="openTab(event, 'clienteTab')">Cadastro de Cliente</button>
        <button class="tablinks" onclick="openTab(event, 'aniversariantesTab')">Aniversariantes</button>
        <button class="tablinks" onclick="openTab(event, 'vendedorTab')">√Årea do Vendedor</button>
    </div>
    
    <!-- Aba de Administra√ß√£o -->
    <div id="adminTab" class="tabcontent" style="display: block;">
        <h2>Gerenciamento de Clientes</h2>
        
        <div class="search">
            <div class="form-group">
                <input type="text" id="searchInput" placeholder="Buscar cliente por nome ou telefone...">
            </div>
            <button class="export-btn" id="exportBtn">Exportar para CSV</button>
            <button class="export-btn" id="aniversariantesMesBtn">Aniversariantes do M√™s</button>
        </div>
        
        <form id="clientForm">
            <h3>Cadastrar Novo Cliente</h3>
            <div class="form-group">
                <label for="nome">Nome Completo:</label>
                <input type="text" id="nome" required>
            </div>
            
            <div class="form-group">
                <label for="telefone">Telefone (WhatsApp):</label>
                <input type="tel" id="telefone" placeholder="(00) 00000-0000" required>
            </div>
            
            <div class="form-group">
                <label for="email">E-mail: <span class="optional-field">(Opcional)</span></label>
                <input type="email" id="email">
            </div>
            
            <div class="form-group">
                <label for="cpf">CPF: <span class="optional-field">(Opcional)</span></label>
                <input type="text" id="cpf" placeholder="000.000.000-00" maxlength="14">
            </div>
            
            <div class="form-group">
                <label for="dataNascimento">Data de Nascimento:</label>
                <input type="date" id="dataNascimento" required>
            </div>
            
            <div class="form-group">
                <label for="preferencias">Prefer√™ncias/Interesses: <span class="optional-field">(Opcional)</span></label>
                <input type="text" id="preferencias" placeholder="Ex: roupas esportivas, cal√ßados, acess√≥rios...">
            </div>
            
            <div class="form-group">
                <label for="vendedor">Vendedor:</label>
                <select id="vendedor">
                    <option value="">Selecione um vendedor</option>
                    <option value="Kassio">Kassio</option>
                    <option value="Priscila">Priscila</option>
                    <option value="Paloma">Paloma</option>
                    <option value="Lucas">Lucas</option>
                </select>
            </div>
            
            <button type="submit">Cadastrar Cliente</button>
        </form>
        
        <div class="clientes-container">
            <table id="clientesTable">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Telefone</th>
                        <th>Data de Nascimento</th>
                        <th>Vendedor</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="clientesList">
                    <!-- Dados dos clientes ser√£o inseridos aqui -->
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Aba de QR Code -->
    <div id="qrcodeTab" class="tabcontent">
        <h2>Gerar QR Code para Cadastro</h2>
        <p>Gere um QR Code para que seus clientes possam se cadastrar diretamente pelo celular deles.</p>
        
        <div class="card">
            <p>Este QR Code levar√° o cliente diretamente ao formul√°rio de cadastro. Voc√™ pode imprimir e colocar no balc√£o da loja ou incluir em materiais promocionais.</p>
            
            <div id="qrcodeContainer"></div>
            
            <div style="text-align: center; margin-top: 15px;">
                <button id="printQRBtn">Imprimir QR Code</button>
            </div>
        </div>
    </div>
    
    <!-- Aba de Cadastro de Cliente -->
    <div id="clienteTab" class="tabcontent">
        <h2>Auto-Cadastro de Cliente</h2>
        <p>Preencha seus dados para se cadastrar em nossa loja e receber ofertas exclusivas!</p>
        
        <form id="clientAutoForm">
            <div class="form-group">
                <label for="clienteNome">Nome Completo:</label>
                <input type="text" id="clienteNome" required>
            </div>
            
            <div class="form-group">
                <label for="clienteTelefone">Telefone (WhatsApp):</label>
                <input type="tel" id="clienteTelefone" placeholder="(00) 00000-0000" required>
            </div>
            
            <div class="form-group">
                <label for="clienteEmail">E-mail: <span class="optional-field">(Opcional)</span></label>
                <input type="email" id="clienteEmail">
            </div>
            
            <div class="form-group">
                <label for="clienteCpf">CPF: <span class="optional-field">(Opcional)</span></label>
                <input type="text" id="clienteCpf" placeholder="000.000.000-00" maxlength="14">
            </div>
            
            <div class="form-group">
                <label for="clienteDataNascimento">Data de Nascimento:</label>
                <input type="date" id="clienteDataNascimento" required>
            </div>
            
            <div class="form-group">
                <label for="clientePreferencias">Prefer√™ncias/Interesses: <span class="optional-field">(Opcional)</span></label>
                <input type="text" id="clientePreferencias" placeholder="Ex: roupas esportivas, cal√ßados, acess√≥rios...">
            </div>
            
            <div class="form-group">
                <label for="clienteVendedor">Vendedor: <span class="optional-field">(Opcional)</span></label>
                <select id="clienteVendedor">
                    <option value="">Selecione um vendedor</option>
                    <option value="Kassio">Kassio</option>
                    <option value="Priscila">Priscila</option>
                    <option value="Paloma">Paloma</option>
                    <option value="Lucas">Lucas</option>
                </select>
            </div>
            
            <button type="submit">Finalizar Cadastro</button>
        </form>
        
        <div id="successMessage" class="success-message">
            Cadastro realizado com sucesso! Obrigado por se cadastrar em nossa loja.
        </div>
    </div>
    
    <!-- Aba de Aniversariantes -->
    <div id="aniversariantesTab" class="tabcontent">
        <h2>Aniversariantes</h2>
        
        <div class="card">
            <h3>Aniversariantes do Dia</h3>
            <p>Clientes que est√£o comemorando anivers√°rio hoje:</p>
            
            <table id="aniversariantesHojeTable">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Telefone</th>
                        <th>Vendedor</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="aniversariantesHojeList">
                    <!-- Dados dos aniversariantes do dia ser√£o inseridos aqui -->
                </tbody>
            </table>
            
            <button id="sendToDayBtn" class="whatsapp-btn" style="margin-top: 15px;">Gerar Links para Aniversariantes do Dia</button>
        </div>
        
        <div class="card">
            <h3>Aniversariantes do M√™s</h3>
            <p>Envie mensagens de parab√©ns e ofertas especiais para os aniversariantes do m√™s.</p>
            
            <div class="message-template">
                <p>A mensagem abaixo ser√° enviada para os aniversariantes. Voc√™ pode personaliz√°-la se desejar:</p>
            </div>
            
            <textarea id="birthdayMessage">A equipe Arena Fit deseja um feliz anivers√°rio para voc√™! üéÇüéä 

Que este dia seja repleto de alegria, sa√∫de e muita energia!

Como nosso presente, aniversariantes do m√™s ganham:
‚úÖ 10% OFF em compras no cart√£o (cr√©dito/d√©bito);
‚úÖ 15% OFF no PIX;
‚úÖ E ainda tem o cupom ARENA15 para usar em nosso site e garantir seu desconto extra!

Celebre com a gente e continue fazendo parte da fam√≠lia Arena Fit!

Um grande abra√ßo,
Equipe Arena Fit
üìû 81 99390-2872 
üìç  Paulista North Way Shopping 
üåê www.arenafitstore.com.br</textarea>
            
            <button id="sendToAllBtn" class="whatsapp-btn" style="margin-top: 15px;">Gerar Links para Aniversariantes</button>
            
            <div class="instructions">
                <h4>Como enviar em lote:</h4>
                <ol>
                    <li>Clique no bot√£o acima para gerar os links</li>
                    <li>Baixe o arquivo com todos os links</li>
                    <li>Abra o WhatsApp Web (web.whatsapp.com)</li>
                    <li>Copie e cole os links um por um</li>
                    <li>Confirme o envio em cada conversa</li>
                </ol>
                <p><strong>Dica:</strong> Envie em grupos de 10-15 links por vez.</p>
            </div>
        </div>
        
        <h3>Lista de Aniversariantes deste M√™s</h3>
        <div class="clientes-container">
            <table id="aniversariantesTable">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Telefone</th>
                        <th>Data de Nascimento</th>
                        <th>Vendedor</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="aniversariantesList">
                    <!-- Dados dos aniversariantes ser√£o inseridos aqui -->
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Nova Aba de √Årea do Vendedor -->
    <div id="vendedorTab" class="tabcontent">
        <h2>√Årea do Vendedor</h2>
        
        <div class="card">
            <h3>Seus Clientes</h3>
            <p>Gerencie os clientes que voc√™ cadastrou e envie mensagens personalizadas.</p>
            
            <div class="search">
                <div class="form-group">
                    <input type="text" id="vendedorSearchInput" placeholder="Buscar cliente por nome ou telefone...">
                </div>
            </div>
            
            <div class="filter-vendedor">
                <label for="selectVendedor">Selecione o vendedor:</label>
                <select id="selectVendedor" onchange="filterClientesByVendedor()">
                    <option value="">Todos os vendedores</option>
                    <option value="Kassio">Kassio</option>
                    <option value="Priscila">Priscila</option>
                    <option value="Paloma">Paloma</option>
                    <option value="Lucas">Lucas</option>
                </select>
            </div>
            
            <div class="clientes-container">
                <table id="vendedorClientesTable">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Telefone</th>
                            <th>Data de Nascimento</th>
                            <th>Prefer√™ncias</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="vendedorClientesList">
                        <!-- Dados dos clientes do vendedor ser√£o inseridos aqui -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="card">
            <h3>Enviar Mensagem para Seus Clientes</h3>
            
            <div class="form-group">
                <label for="vendedorMessage">Mensagem:</label>
                <textarea id="vendedorMessage" style="width: 100%; height: 150px;" placeholder="Digite sua mensagem personalizada para os clientes..."></textarea>
            </div>
            
            <button id="sendToMyClientsBtn" class="whatsapp-btn">Gerar Links para Meus Clientes</button>
            
            <div class="instructions">
                <h4>Como enviar em lote:</h4>
                <ol>
                    <li>Selecione seu nome no campo acima</li>
                    <li>Digite a mensagem que deseja enviar</li>
                    <li>Clique no bot√£o "Gerar Links para Meus Clientes"</li>
                    <li>Baixe o arquivo com todos os links</li>
                    <li>Abra o WhatsApp Web (web.whatsapp.com)</li>
                    <li>Copie e cole os links um por um</li>
                    <li>Confirme o envio em cada conversa</li>
                </ol>
                <p><strong>Dica:</strong> Envie em grupos de 10-15 links por vez.</p>
            </div>
        </div>
    </div>
    
    <!-- Modal de Edi√ß√£o -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Editar Cliente</h2>
            <form id="editClientForm">
                <input type="hidden" id="editId">
                
                <div class="form-group">
                    <label for="editNome">Nome Completo:</label>
                    <input type="text" id="editNome" required>
                </div>
                
                <div class="form-group">
                    <label for="editTelefone">Telefone (WhatsApp):</label>
                    <input type="tel" id="editTelefone" placeholder="(00) 00000-0000" required>
                </div>
                
                <div class="form-group">
                    <label for="editEmail">E-mail: <span class="optional-field">(Opcional)</span></label>
                    <input type="email" id="editEmail">
                </div>
                
                <div class="form-group">
                    <label for="editCpf">CPF: <span class="optional-field">(Opcional)</span></label>
                    <input type="text" id="editCpf" placeholder="000.000.000-00" maxlength="14">
                </div>
                
                <div class="form-group">
                    <label for="editDataNascimento">Data de Nascimento:</label>
                    <input type="date" id="editDataNascimento" required>
                </div>
                
                <div class="form-group">
                    <label for="editPreferencias">Prefer√™ncias/Interesses: <span class="optional-field">(Opcional)</span></label>
                    <input type="text" id="editPreferencias" placeholder="Ex: roupas esportivas, cal√ßados, acess√≥rios...">
                </div>
                
                <div class="form-group">
                    <label for="editVendedor">Vendedor:</label>
                    <select id="editVendedor">
                        <option value="">Selecione um vendedor</option>
                        <option value="Kassio">Kassio</option>
                        <option value="Priscila">Priscila</option>
                        <option value="Paloma">Paloma</option>
                        <option value="Lucas">Lucas</option>
                    </select>
                </div>
                
                <button type="submit">Salvar Altera√ß√µes</button>
            </form>
        </div>
    </div>
    
    <script>
        // Configura√ß√µes do JSONBin.io
        const JSONBIN_BIN_ID = "67eecbdb8561e97a50f82e67";
        const JSONBIN_API_KEY = "$2a$10$d5YK0H0XW5V.JF/Qhy.AQO8lNhwtjuzfghPgreK7B/hj5hd6PULd6";
        const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`;
        const JSONBIN_HEADERS = {
            "Content-Type": "application/json",
            "X-Master-Key": JSONBIN_API_KEY
        };

        // Elementos do modal
        const modal = document.getElementById("editModal");
        const span = document.getElementsByClassName("close")[0];
        const editForm = document.getElementById("editClientForm");

        document.addEventListener('DOMContentLoaded', function() {
            // Configurar QR Code
            setupQRCode();
            
            // Verificar se foi acessado via QR Code
            checkUrlParams();
            
            // Carregar clientes salvos quando a p√°gina carregar
            loadClientes().then(() => {
                loadAniversariantes();
                loadAniversariantesHoje();
                filterClientesByVendedor();
            });
            
            // Formata√ß√£o do telefone (limita a 11 d√≠gitos e formata)
            document.getElementById('telefone').addEventListener('input', formatarTelefone);
            document.getElementById('clienteTelefone').addEventListener('input', formatarTelefone);
            document.getElementById('editTelefone').addEventListener('input', formatarTelefone);
            
            // Formata√ß√£o do CPF
            document.getElementById('cpf').addEventListener('input', formatarCPF);
            document.getElementById('clienteCpf').addEventListener('input', formatarCPF);
            document.getElementById('editCpf').addEventListener('input', formatarCPF);
            
            // Manipular envio do formul√°rio de admin
            document.getElementById('clientForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const cliente = {
                    id: Date.now(), // ID √∫nico baseado no timestamp
                    nome: document.getElementById('nome').value,
                    telefone: document.getElementById('telefone').value,
                    email: document.getElementById('email').value,
                    cpf: document.getElementById('cpf').value,
                    dataNascimento: document.getElementById('dataNascimento').value,
                    preferencias: document.getElementById('preferencias').value,
                    vendedor: document.getElementById('vendedor').value,
                    timestamp: new Date().toISOString()
                };
                
                // Salvar cliente
                await saveCliente(cliente);
                
                // Limpar formul√°rio
                this.reset();
                document.getElementById('vendedor').value = '';
                
                // Recarregar listas
                await loadClientes();
                loadAniversariantes();
                loadAniversariantesHoje();
                filterClientesByVendedor();
            });
            
            // Manipular envio do formul√°rio de auto-cadastro
            document.getElementById('clientAutoForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const cliente = {
                    id: Date.now(), // ID √∫nico baseado no timestamp
                    nome: document.getElementById('clienteNome').value,
                    telefone: document.getElementById('clienteTelefone').value,
                    email: document.getElementById('clienteEmail').value,
                    cpf: document.getElementById('clienteCpf').value,
                    dataNascimento: document.getElementById('clienteDataNascimento').value,
                    preferencias: document.getElementById('clientePreferencias').value,
                    vendedor: document.getElementById('clienteVendedor').value,
                    timestamp: new Date().toISOString()
                };
                
                // Salvar cliente
                await saveCliente(cliente);
                
                // Limpar formul√°rio
                this.reset();
                document.getElementById('clienteVendedor').value = '';
                
                // Mostrar mensagem de sucesso
                document.getElementById('successMessage').style.display = 'block';
                
                // Ocultar mensagem ap√≥s 3 segundos
                setTimeout(function() {
                    document.getElementById('successMessage').style.display = 'none';
                }, 3000);
                
                // Recarregar listas
                await loadClientes();
                loadAniversariantes();
                loadAniversariantesHoje();
                filterClientesByVendedor();
            });
            
            // Manipular envio do formul√°rio de edi√ß√£o
            editForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const clienteEditado = {
                    id: parseInt(document.getElementById('editId').value),
                    nome: document.getElementById('editNome').value,
                    telefone: document.getElementById('editTelefone').value,
                    email: document.getElementById('editEmail').value,
                    cpf: document.getElementById('editCpf').value,
                    dataNascimento: document.getElementById('editDataNascimento').value,
                    preferencias: document.getElementById('editPreferencias').value,
                    vendedor: document.getElementById('editVendedor').value,
                    timestamp: new Date().toISOString()
                };
                
                // Atualizar cliente
                await updateCliente(clienteEditado);
                
                // Fechar modal
                modal.style.display = "none";
                
                // Recarregar listas
                await loadClientes();
                loadAniversariantes();
                loadAniversariantesHoje();
                filterClientesByVendedor();
            });
            
            // Fechar modal quando clicar no X
            span.onclick = function() {
                modal.style.display = "none";
            }
            
            // Fechar modal quando clicar fora dele
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
            
            // Pesquisar clientes na √°rea administrativa
            document.getElementById('searchInput').addEventListener('keyup', async function() {
                const searchTerm = this.value.toLowerCase();
                const clientes = await getClientesFromStorage();
                
                const filteredClientes = clientes.filter(cliente => 
                    cliente.nome.toLowerCase().includes(searchTerm) || 
                    cliente.telefone.includes(searchTerm)
                );
                
                renderClientesList(filteredClientes);
            });
            
            // Pesquisar clientes na √°rea do vendedor
            document.getElementById('vendedorSearchInput').addEventListener('keyup', async function() {
                const searchTerm = this.value.toLowerCase();
                const vendedor = document.getElementById('selectVendedor').value;
                const clientes = await getClientesFromStorage();
                
                let filteredClientes = clientes;
                
                if (vendedor) {
                    filteredClientes = filteredClientes.filter(cliente => cliente.vendedor === vendedor);
                }
                
                filteredClientes = filteredClientes.filter(cliente => 
                    cliente.nome.toLowerCase().includes(searchTerm) || 
                    cliente.telefone.includes(searchTerm)
                );
                
                renderVendedorClientesList(filteredClientes);
            });
            
            // Exportar para CSV
            document.getElementById('exportBtn').addEventListener('click', exportToCSV);
            
            // Aniversariantes do m√™s
            document.getElementById('aniversariantesMesBtn').addEventListener('click', function() {
                showAniversariantes();
                // Abrir a aba de aniversariantes
                document.querySelector('.tablinks[onclick*="aniversariantesTab"]').click();
            });
            
            // Enviar mensagem para todos os aniversariantes do m√™s
            document.getElementById('sendToAllBtn').addEventListener('click', async function() {
                const aniversariantes = await getAniversariantes();
                if (aniversariantes.length === 0) {
                    alert('N√£o h√° aniversariantes neste m√™s para enviar mensagens.');
                    return;
                }
                
                if (confirm(`Deseja gerar links para ${aniversariantes.length} aniversariante(s)?`)) {
                    sendToAllAniversariantes();
                }
            });
            
            // Enviar mensagem para aniversariantes do dia
            document.getElementById('sendToDayBtn').addEventListener('click', async function() {
                const aniversariantesHoje = await getAniversariantesHoje();
                if (aniversariantesHoje.length === 0) {
                    alert('N√£o h√° aniversariantes hoje para enviar mensagens.');
                    return;
                }
                
                if (confirm(`Deseja gerar links para ${aniversariantesHoje.length} aniversariante(s) de hoje?`)) {
                    sendToAllAniversariantesHoje();
                }
            });
            
            // Enviar mensagem para clientes do vendedor
            document.getElementById('sendToMyClientsBtn').addEventListener('click', async function() {
                const vendedor = document.getElementById('selectVendedor').value;
                const mensagem = document.getElementById('vendedorMessage').value;
                
                if (!vendedor) {
                    alert('Por favor, selecione um vendedor primeiro.');
                    return;
                }
                
                if (!mensagem.trim()) {
                    alert('Por favor, digite uma mensagem para enviar.');
                    return;
                }
                
                const clientes = await getClientesByVendedor(vendedor);
                if (clientes.length === 0) {
                    alert(`N√£o h√° clientes cadastrados para o vendedor ${vendedor}.`);
                    return;
                }
                
                if (confirm(`Deseja gerar links para ${clientes.length} cliente(s) do vendedor ${vendedor}?`)) {
                    sendToVendedorClientes(vendedor, mensagem);
                }
            });
            
            // Imprimir QR Code
            document.getElementById('printQRBtn').addEventListener('click', function() {
                const printWindow = window.open('', '_blank');
                const qrCodeImg = document.querySelector('#qrcodeContainer img').src;
                
                printWindow.document.write(`
                    <html>
                    <head>
                        <title>QR Code para Cadastro</title>
                        <style>
                            body { font-family: Arial, sans-serif; text-align: center; }
                            .container { margin: 50px auto; }
                        </style>
                    </head>
                    <body>
                        <div class="container">
                            <h2>Cadastre-se em nossa loja!</h2>
                            <p>Escaneie o QR Code abaixo para se cadastrar e receber ofertas exclusivas.</p>
                            <img src="${qrCodeImg}" style="width: 250px; height: 250px;">
                            <p>Obrigado pela prefer√™ncia!</p>
                        </div>
                    </body>
                    </html>
                `);
                
                printWindow.document.close();
                printWindow.focus();
                setTimeout(function() {
                    printWindow.print();
                }, 500);
            });
        });
        
        // ==============================================
        // NOVAS FUN√á√ïES PARA ENVIO EM LOTE VIA ARQUIVO
        // ==============================================

        function formatTelefoneForLink(telefone) {
            // Remove tudo que n√£o √© d√≠gito e adiciona c√≥digo do pa√≠s
            let numero = telefone.replace(/\D/g, '');
            if (!numero.startsWith('55') && numero.length > 0) {
                numero = '55' + numero;
            }
            return numero;
        }

        function gerarLinksWhatsAppEmLote(clientes, mensagem) {
            if (clientes.length === 0) {
                alert('Nenhum cliente encontrado!');
                return;
            }

            let conteudoArquivo = `LINKS PARA ENVIO EM MASSA - ${new Date().toLocaleDateString()}\n\n`;
            conteudoArquivo += "INSTRU√á√ïES:\n";
            conteudoArquivo += "1. Abra o WhatsApp Web (web.whatsapp.com)\n";
            conteudoArquivo += "2. Copie cada link abaixo e cole em uma conversa\n";
            conteudoArquivo += "3. Clique no link para abrir o chat\n";
            conteudoArquivo += "4. Confirme o envio da mensagem\n\n";
            conteudoArquivo += "LISTA DE LINKS:\n\n";

            clientes.forEach((cliente, index) => {
                const telefoneFormatado = formatTelefoneForLink(cliente.telefone);
                const nomeCliente = cliente.nome.split(' ')[0]; // Pega apenas o primeiro nome
                const mensagemPersonalizada = `Ol√° ${nomeCliente},\n\n${mensagem}`;
                const link = `https://wa.me/${telefoneFormatado}?text=${encodeURIComponent(mensagemPersonalizada)}`;
                
                conteudoArquivo += `${index + 1}. ${cliente.nome} (${cliente.telefone}):\n${link}\n\n`;
            });

            // Criar e baixar o arquivo
            const blob = new Blob([conteudoArquivo], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `Links_WhatsApp_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            // Mostrar instru√ß√µes detalhadas
            alert(`
‚úÖ ARQUIVO GERADO COM SUCESSO!

O que fazer agora:
1. Baixe o arquivo "Links_WhatsApp_*.txt"
2. Abra o WhatsApp Web (web.whatsapp.com)
3. Abra o arquivo e copie os links
4. Cole cada link em uma conversa no WhatsApp
5. Clique no link para abrir o chat e envie

Dica importante:
‚Ä¢ Envie em grupos de 10-15 links por vez
‚Ä¢ Aguarde alguns segundos entre cada envio
‚Ä¢ N√£o feche esta p√°gina at√© terminar
            `);
        }

        // ==============================================
        // FUN√á√ïES PARA EDI√á√ÉO DE CLIENTES
        // ==============================================

        async function updateCliente(clienteEditado) {
            try {
                // Primeiro obtemos a lista atual de clientes
                const clientes = await getClientesFromStorage();
                
                // Encontramos o √≠ndice do cliente a ser atualizado
                const index = clientes.findIndex(c => c.id === clienteEditado.id);
                
                if (index === -1) {
                    throw new Error('Cliente n√£o encontrado para atualiza√ß√£o');
                }
                
                // Atualizamos o cliente
                clientes[index] = clienteEditado;
                
                // Atualizamos o bin no JSONBin.io
                const response = await fetch(JSONBIN_URL, {
                    method: 'PUT',
                    headers: JSONBIN_HEADERS,
                    body: JSON.stringify({ clientes })
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao atualizar cliente');
                }
                
                return true;
            } catch (error) {
                console.error('Erro ao atualizar cliente:', error);
                return false;
            }
        }

        function openEditModal(clienteId) {
            getClientesFromStorage().then(clientes => {
                const cliente = clientes.find(c => c.id === clienteId);
                
                if (cliente) {
                    // Preencher o formul√°rio de edi√ß√£o com os dados do cliente
                    document.getElementById('editId').value = cliente.id;
                    document.getElementById('editNome').value = cliente.nome;
                    document.getElementById('editTelefone').value = cliente.telefone;
                    document.getElementById('editEmail').value = cliente.email || '';
                    document.getElementById('editCpf').value = cliente.cpf || '';
                    document.getElementById('editDataNascimento').value = cliente.dataNascimento;
                    document.getElementById('editPreferencias').value = cliente.preferencias || '';
                    document.getElementById('editVendedor').value = cliente.vendedor || '';
                    
                    // Abrir o modal
                    modal.style.display = "block";
                }
            });
        }

        // ==============================================
        // SUBSTITUA AS FUN√á√ïES DE ENVIO ORIGINAIS
        // ==============================================

        async function sendToAllAniversariantes() {
            const aniversariantes = await getAniversariantes();
            if (aniversariantes.length === 0) {
                alert('N√£o h√° aniversariantes neste m√™s.');
                return;
            }

            const mensagem = document.getElementById('birthdayMessage').value;
            gerarLinksWhatsAppEmLote(aniversariantes, mensagem);
        }

        async function sendToAllAniversariantesHoje() {
            const aniversariantesHoje = await getAniversariantesHoje();
            if (aniversariantesHoje.length === 0) {
                alert('N√£o h√° aniversariantes hoje.');
                return;
            }

            const mensagem = document.getElementById('birthdayMessage').value;
            gerarLinksWhatsAppEmLote(aniversariantesHoje, mensagem);
        }

        async function sendToVendedorClientes(vendedor, mensagem) {
            const clientes = await getClientesByVendedor(vendedor);
            if (clientes.length === 0) {
                alert(`Nenhum cliente encontrado para o vendedor ${vendedor}.`);
                return;
            }

            gerarLinksWhatsAppEmLote(clientes, mensagem);
        }
        
        // Fun√ß√£o para carregar aniversariantes do dia
        async function loadAniversariantesHoje() {
            const aniversariantesHoje = await getAniversariantesHoje();
            renderAniversariantesHojeList(aniversariantesHoje);
        }
        
        async function getAniversariantesHoje() {
            const clientes = await getClientesFromStorage();
            const dataAtual = new Date();
            const diaAtual = dataAtual.getDate();
            const mesAtual = dataAtual.getMonth() + 1; // Janeiro √© 0
            
            return clientes.filter(cliente => {
                // Extrai dia e m√™s diretamente da string YYYY-MM-DD
                const partesData = cliente.dataNascimento.split('-');
                const diaAniversario = parseInt(partesData[2]);
                const mesAniversario = parseInt(partesData[1]);
                
                return diaAniversario === diaAtual && mesAniversario === mesAtual;
            });
        }
        
        function renderAniversariantesHojeList(aniversariantesHoje) {
            const aniversariantesHojeList = document.getElementById('aniversariantesHojeList');
            aniversariantesHojeList.innerHTML = '';
            
            if (aniversariantesHoje.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="4" style="text-align: center;">N√£o h√° aniversariantes hoje.</td>`;
                aniversariantesHojeList.appendChild(row);
                return;
            }
            
            aniversariantesHoje.forEach(cliente => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${cliente.nome}</td>
                    <td>${cliente.telefone}</td>
                    <td>${cliente.vendedor || ''}</td>
                    <td>
                        <button class="whatsapp-btn" onclick="enviarMensagemAniversario(${cliente.id})">Enviar Mensagem</button>
                        <button class="edit-btn" onclick="openEditModal(${cliente.id})">Editar</button>
                    </td>
                `;
                aniversariantesHojeList.appendChild(row);
            });
        }
        
        // Fun√ß√µes para √°rea do vendedor
        async function filterClientesByVendedor() {
            const vendedor = document.getElementById('selectVendedor').value;
            const searchTerm = document.getElementById('vendedorSearchInput').value.toLowerCase();
            const clientes = await getClientesFromStorage();
            
            let filteredClientes = clientes;
            
            if (vendedor) {
                filteredClientes = filteredClientes.filter(cliente => cliente.vendedor === vendedor);
            }
            
            if (searchTerm) {
                filteredClientes = filteredClientes.filter(cliente => 
                    cliente.nome.toLowerCase().includes(searchTerm) || 
                    cliente.telefone.includes(searchTerm)
                );
            }
            
            renderVendedorClientesList(filteredClientes);
        }
        
        async function getClientesByVendedor(vendedor) {
            const clientes = await getClientesFromStorage();
            return clientes.filter(cliente => cliente.vendedor === vendedor);
        }
        
        function renderVendedorClientesList(clientes) {
            const vendedorClientesList = document.getElementById('vendedorClientesList');
            vendedorClientesList.innerHTML = '';
            
            if (clientes.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="5" style="text-align: center;">N√£o h√° clientes cadastrados.</td>`;
                vendedorClientesList.appendChild(row);
                return;
            }
            
            // Ordenar por mais recente primeiro
            clientes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            clientes.forEach(cliente => {
                // Extrai a data diretamente do formato YYYY-MM-DD sem convers√£o de timezone
                const partesData = cliente.dataNascimento.split('-');
                const dataFormatada = `${partesData[2]}/${partesData[1]}/${partesData[0]}`;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${cliente.nome}</td>
                    <td>${cliente.telefone}</td>
                    <td>${dataFormatada}</td>
                    <td>${cliente.preferencias || ''}</td>
                    <td>
                        <button class="whatsapp-btn" onclick="enviarWhatsApp(${cliente.id})">WhatsApp</button>
                        <button class="edit-btn" onclick="openEditModal(${cliente.id})">Editar</button>
                    </td>
                `;
                vendedorClientesList.appendChild(row);
            });
        }
        
        function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const page = urlParams.get('page');
            
            if (page === 'cliente') {
                // Adicionar classe especial ao body
                document.body.classList.add('qr-code-view');
                
                // Esconder a barra de abas
                document.querySelector('.tab').style.display = 'none';
                
                // Mostrar apenas o formul√°rio de cadastro do cliente
                document.getElementById('clienteTab').style.display = 'block';
                
                // Ajustar o t√≠tulo
                document.querySelector('h1').textContent = 'Cadastro de Cliente';
                
                // Esconder todas as outras abas
                const tabcontents = document.getElementsByClassName('tabcontent');
                for (let i = 0; i < tabcontents.length; i++) {
                    if (tabcontents[i].id !== 'clienteTab') {
                        tabcontents[i].style.display = 'none';
                    }
                }
            }
        }
        
        function formatarTelefone() {
            // Remove tudo que n√£o √© d√≠gito
            this.value = this.value.replace(/\D/g, '');
            
            // Limita a 11 caracteres (DDD + n√∫mero)
            if (this.value.length > 11) {
                this.value = this.value.substring(0, 11);
            }
            
            // Formata√ß√£o do telefone
            if (this.value.length > 2) {
                this.value = `(${this.value.substring(0, 2)}) ${this.value.substring(2)}`;
            }
            
            // Limita novamente ap√≥s formata√ß√£o
            if (this.value.length > 15) {
                this.value = this.value.substring(0, 15);
            }
        }
        
        function formatarCPF() {
            // Remove tudo que n√£o √© d√≠gito
            let value = this.value.replace(/\D/g, '');
            
            // Formata√ß√£o autom√°tica do CPF
            if (value.length > 3) {
                value = value.substring(0, 3) + '.' + value.substring(3);
            }
            if (value.length > 7) {
                value = value.substring(0, 7) + '.' + value.substring(7);
            }
            if (value.length > 11) {
                value = value.substring(0, 11) + '-' + value.substring(11);
            }
            
            // Limita a 14 caracteres (com pontua√ß√£o)
            if (value.length > 14) {
                value = value.substring(0, 14);
            }
            
            this.value = value;
        }
        
        function setupQRCode() {
            // URL para cadastro de cliente - SUBSTITUA PELA SUA URL DO GITHUB PAGES
            const clienteUrl = "https://arenafitnw.github.io/cadastro/?page=cliente";
            
            // Gerar QR Code
            new QRCode(document.getElementById("qrcodeContainer"), {
                text: clienteUrl,
                width: 200,
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }
        
        function openTab(evt, tabName) {
            // Ocultar todos os conte√∫dos de guias
            const tabcontent = document.getElementsByClassName("tabcontent");
            for (let i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            // Remover a classe ativa de todas as guias
            const tablinks = document.getElementsByClassName("tablinks");
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }

            // Mostrar o conte√∫do da guia atual e adicionar classe ativa
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
            
            // Se abriu a aba de aniversariantes, recarregar as listas
            if (tabName === 'aniversariantesTab') {
                loadAniversariantes();
                loadAniversariantesHoje();
            }
            
            // Se abriu a aba do vendedor, recarregar a lista
            if (tabName === 'vendedorTab') {
                filterClientesByVendedor();
            }
        }
        
        // Fun√ß√µes para trabalhar com JSONBin.io
        async function getClientesFromStorage() {
            try {
                const response = await fetch(JSONBIN_URL, {
                    method: 'GET',
                    headers: JSONBIN_HEADERS
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao carregar clientes');
                }
                
                const data = await response.json();
                return data.record.clientes || [];
            } catch (error) {
                console.error('Erro ao carregar clientes:', error);
                return [];
            }
        }
        
        async function saveCliente(cliente) {
            try {
                // Primeiro obtemos a lista atual de clientes
                const clientes = await getClientesFromStorage();
                
                // Adicionamos o novo cliente
                clientes.push(cliente);
                
                // Atualizamos o bin no JSONBin.io
                const response = await fetch(JSONBIN_URL, {
                    method: 'PUT',
                    headers: JSONBIN_HEADERS,
                    body: JSON.stringify({ clientes })
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao salvar cliente');
                }
                
                return true;
            } catch (error) {
                console.error('Erro ao salvar cliente:', error);
                return false;
            }
        }
        
        async function deleteCliente(id) {
            try {
                // Primeiro obtemos a lista atual de clientes
                const clientes = await getClientesFromStorage();
                
                // Filtramos para remover o cliente com o ID especificado
                const updatedClientes = clientes.filter(cliente => cliente.id !== id);
                
                // Atualizamos o bin no JSONBin.io
                const response = await fetch(JSONBIN_URL, {
                    method: 'PUT',
                    headers: JSONBIN_HEADERS,
                    body: JSON.stringify({ clientes: updatedClientes })
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao excluir cliente');
                }
                
                // Recarregamos as listas
                await loadClientes();
                loadAniversariantes();
                loadAniversariantesHoje();
                filterClientesByVendedor();
                
                return true;
            } catch (error) {
                console.error('Erro ao excluir cliente:', error);
                return false;
            }
        }
        
        async function loadClientes() {
            try {
                const clientes = await getClientesFromStorage();
                // Ordenar por mais recente primeiro
                clientes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                renderClientesList(clientes);
                return clientes;
            } catch (error) {
                console.error('Erro ao carregar clientes:', error);
                return [];
            }
        }
        
        function renderClientesList(clientes) {
            const clientesList = document.getElementById('clientesList');
            clientesList.innerHTML = '';
            
            clientes.forEach(cliente => {
                // Extrai a data diretamente do formato YYYY-MM-DD sem convers√£o de timezone
                const partesData = cliente.dataNascimento.split('-');
                const dataFormatada = `${partesData[2]}/${partesData[1]}/${partesData[0]}`;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${cliente.nome}</td>
                    <td>${cliente.telefone}</td>
                    <td>${dataFormatada}</td>
                    <td>${cliente.vendedor || ''}</td>
                    <td>
                        <button onclick="visualizarCliente(${cliente.id})">Visualizar</button>
                        <button class="whatsapp-btn" onclick="enviarWhatsApp(${cliente.id})">WhatsApp</button>
                        <button class="edit-btn" onclick="openEditModal(${cliente.id})">Editar</button>
                        <button class="delete-btn" onclick="deleteCliente(${cliente.id})">Excluir</button>
                    </td>
                `;
                clientesList.appendChild(row);
            });
        }
        
        async function loadAniversariantes() {
            const aniversariantes = await getAniversariantes();
            renderAniversariantesList(aniversariantes);
        }
        
        async function getAniversariantes() {
            const clientes = await getClientesFromStorage();
            const dataAtual = new Date();
            const mesAtual = dataAtual.getMonth() + 1; // Janeiro √© 0
            
            return clientes.filter(cliente => {
                // Extrai o m√™s diretamente da string YYYY-MM-DD
                const mesAniversario = parseInt(cliente.dataNascimento.split('-')[1]);
                return mesAniversario === mesAtual;
            });
        }
        
        function renderAniversariantesList(aniversariantes) {
            const aniversariantesList = document.getElementById('aniversariantesList');
            aniversariantesList.innerHTML = '';
            
            if (aniversariantes.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="5" style="text-align: center;">N√£o h√° aniversariantes neste m√™s.</td>`;
                aniversariantesList.appendChild(row);
                return;
            }
            
            aniversariantes.forEach(cliente => {
                // Extrai a data diretamente do formato YYYY-MM-DD sem convers√£o de timezone
                const partesData = cliente.dataNascimento.split('-');
                const dataFormatada = `${partesData[2]}/${partesData[1]}/${partesData[0]}`;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${cliente.nome}</td>
                    <td>${cliente.telefone}</td>
                    <td>${dataFormatada}</td>
                    <td>${cliente.vendedor || ''}</td>
                    <td>
                        <button class="whatsapp-btn" onclick="enviarMensagemAniversario(${cliente.id})">Enviar Mensagem</button>
                        <button class="edit-btn" onclick="openEditModal(${cliente.id})">Editar</button>
                    </td>
                `;
                aniversariantesList.appendChild(row);
            });
        }
        
        function visualizarCliente(id) {
            const clientes = getClientesFromStorage().then(clientes => {
                const cliente = clientes.find(c => c.id === id);
                
                if (cliente) {
                    // Extrai a data diretamente do formato YYYY-MM-DD sem convers√£o de timezone
                    const partesData = cliente.dataNascimento.split('-');
                    const dataFormatada = `${partesData[2]}/${partesData[1]}/${partesData[0]}`;
                    
                    alert(`
                        Nome: ${cliente.nome}
                        Telefone: ${cliente.telefone}
                        Email: ${cliente.email || 'N√£o informado'}
                        CPF: ${cliente.cpf || 'N√£o informado'}
                        Data de Nascimento: ${dataFormatada}
                        Prefer√™ncias: ${cliente.preferencias || 'N√£o informado'}
                        Vendedor: ${cliente.vendedor || 'N√£o informado'}
                    `);
                }
            });
        }
        
        function formatTelefone(telefone) {
            // Remove todos os caracteres n√£o num√©ricos
            const numero = telefone.replace(/\D/g, '');
            
            // Verifica se o n√∫mero come√ßa com 0
            if (numero.startsWith('0')) {
                return numero.substring(1);
            }
            
            // Verifica se tem o c√≥digo do pa√≠s (55)
            if (!numero.startsWith('55')) {
                return '55' + numero;
            }
            
            return numero;
        }
        
        function enviarWhatsApp(id) {
            getClientesFromStorage().then(clientes => {
                const cliente = clientes.find(c => c.id === id);
                
                if (cliente) {
                    const telefoneFormatado = formatTelefone(cliente.telefone);
                    let mensagem = `Ol√° ${cliente.nome}, tudo bem? `;
                    
                    if (cliente.vendedor) {
                        mensagem += `\n\nAtenciosamente,\n${cliente.vendedor}\nEquipe Arena Fit`;
                    }
                    
                    const url = `https://api.whatsapp.com/send?phone=${telefoneFormatado}&text=${encodeURIComponent(mensagem)}`;
                    window.open(url, '_blank');
                }
            });
        }
        
        function enviarMensagemAniversario(id) {
            getClientesFromStorage().then(clientes => {
                const cliente = clientes.find(c => c.id === id);
                
                if (cliente) {
                    const telefoneFormatado = formatTelefone(cliente.telefone);
                    const mensagem = document.getElementById('birthdayMessage').value;
                    let mensagemPersonalizada = `Ol√° ${cliente.nome}, \n\n${mensagem}`;
                    
                    if (cliente.vendedor) {
                        mensagemPersonalizada += `\n\nAtenciosamente,\n${cliente.vendedor}\nEquipe Arena Fit`;
                    }
                    
                    const url = `https://api.whatsapp.com/send?phone=${telefoneFormatado}&text=${encodeURIComponent(mensagemPersonalizada)}`;
                    window.open(url, '_blank');
                }
            });
        }
        
        async function exportToCSV() {
            const clientes = await getClientesFromStorage();
            
            if (clientes.length === 0) {
                alert('N√£o h√° clientes cadastrados para exportar.');
                return;
            }
            
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Nome,Telefone,Email,CPF,Data de Nascimento,Prefer√™ncias,Vendedor\n";
            
            clientes.forEach(cliente => {
                csvContent += `"${cliente.nome}","${cliente.telefone}","${cliente.email || ''}","${cliente.cpf || ''}","${cliente.dataNascimento}","${cliente.preferencias || ''}","${cliente.vendedor || ''}"\n`;
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "clientes.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        async function showAniversariantes() {
            const aniversariantes = await getAniversariantes();
            
            if (aniversariantes.length === 0) {
                alert('N√£o h√° aniversariantes neste m√™s.');
            } else {
                renderClientesList(aniversariantes);
            }
        }
        
        // Fun√ß√µes globais que precisam ser acessadas pelo HTML
        window.deleteCliente = deleteCliente;
        window.visualizarCliente = visualizarCliente;
        window.enviarWhatsApp = enviarWhatsApp;
        window.enviarMensagemAniversario = enviarMensagemAniversario;
        window.openTab = openTab;
        window.filterClientesByVendedor = filterClientesByVendedor;
        window.openEditModal = openEditModal;
    </script>
</body>
</html>
